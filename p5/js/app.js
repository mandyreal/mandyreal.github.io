"use strict";var viewModel=function(){function e(e){for(var o=0;o<v.length;o++){null===v[o].map&&v[o].setMap(r),-1===v[o].title.toLowerCase().indexOf(e)&&v[o].setMap(null);for(var t=0;t<p.topPicksFiltered().length;t++)v[o].title.toLowerCase()===p.topPicksFiltered()[t].venue.name.toLowerCase()&&v[o].setMap(r)}}function o(){var e={zoom:14,disableDefaultUI:!0};try{r=new google.maps.Map(document.getElementById("map-canvas"),e),google.maps.event.addDomListener(window,"resize",function(){var e=r.getCenter();google.maps.event.trigger(r,"resize"),r.setCenter(e)}),c=new google.maps.InfoWindow}catch(o){}}function t(e){var o=e.geometry.location.lat(),t=e.geometry.location.lng(),n=new google.maps.LatLng(o,t);r.setCenter(n),r.setZoom(14);var i="https://api.foursquare.com/v2/venues/explore?ll=",a=o+", "+t,l="&limit=15&section=topPicks&day=any&time=any&locale=en",c="&client_id=1AMO01APWLHPX1VNICMSOD2VWXQSDRUMFDSVTSTJZITY2ZQE",g="&client_secret=XYSEVN4ABIDAWIULKL14TM5GABGQP3EWUOYHOH4XIXSWK2JT&v=YYYYMMDD&v=20141121",v=i+a+l+c+g;$.getJSON(v,function(e){$("#listBox").css("display","inline"),p.topPicks(e.response.groups[0].items);for(var o=0;o<p.topPicks().length;o++)s(p.topPicks()[o].venue,p.topPicks()[o].tips)}).error(function(){$("#listBox").css("display","none")})}function n(e,o){return o!=google.maps.places.PlacesServiceStatus.OK?void $("#listBox").css("display","none"):($("#listBox").css("display","inline"),void t(e[0]))}function s(e,o){var t=e.location.lat,n=e.location.lng,s=e.name,i=e.categories[0].name,l=new google.maps.LatLng(t,n),g="TIP: "+o[0].text,d=e.url,u=new google.maps.Marker({map:r,position:l,title:s});v.push(u);var m,f;void 0!==d?(m='</span></p><p><a href="'+d+'" class="v-link" target="_blank">'+d+"</a></p>",f='<div class="infowindow"><p><span class="v-name">'+s+'</span></p><p class="v-category"><span>'+i+m+'<p class="v-tip"><span>'+g):f='<div class="infowindow"><p><span class="v-name">'+s+'</span></p><p class="v-category"><span>'+i+'</span></p><p class="v-tip"><span> '+g,google.maps.event.addListener(u,"click",function(){c.setContent(f),c.open(r,u),a(s)}),google.maps.event.addListener(u,"mouseover",function(){c.setContent(f),c.open(r,u)}),google.maps.event.addListener(c,"closeclick",function(){p.selectedVenue("")})}function i(e){var o={query:e};l=new google.maps.places.PlacesService(r),l.textSearch(o,n)}function a(e){var o=e;p.selectedVenue(o),document.getElementById(o).scrollIntoView()}var r,l,c,p=this,g="Singapore, Singapore",v=[];p.topPicks=ko.observableArray([]),p.topPicksFiltered=ko.observableArray(p.topPicks()),p.neighborhood=ko.observable(g),p.filterString=ko.observable(""),p.selectedVenue=ko.observable(""),o(),p.newNeighborhood=ko.computed(function(){""!==p.neighborhood()&&(p.filterString(""),i(p.neighborhood()))}),p.clickVenue=function(e){for(var o=e.venue.name,t=0;t<v.length;t++)o===v[t].title&&(google.maps.event.trigger(v[t],"click"),r.panTo(v[t].position),r.setZoom(15))},p.filterTopPicks=ko.computed(function(){for(var e,o=[],t=p.filterString().toLowerCase(),n=0;n<p.topPicks().length;n++)e=p.topPicks()[n].venue,(-1!=e.name.toLowerCase().indexOf(t)||-1!=e.categories[0].name.toLowerCase().indexOf(t))&&o.push(p.topPicks()[n]);p.topPicksFiltered(o)}),p.filterMarkers=ko.computed(function(){e(p.filterString().toLowerCase())})};$(function(){ko.applyBindings(new viewModel)});